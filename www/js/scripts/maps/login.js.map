{"version":3,"sources":["login.js"],"names":["inform","msg","color","$caption","text","$button","toggleClass","setup_button","window","loggedInUser","click","event","navigator","id","logout","preventDefault","request","focus","on_login","assertion","$","ajax","type","url","data","dataType","headers","Access-Control-Allow-Credentials","success","res","status","location","reload","message","error","console","on_logout","csrf","x_csrf","require","$script","href","class","css","margin-top","appendTo","watch","onlogin","onlogout","rel"],"mappings":"CAAA,WAaC,QAASA,GAAOC,EAAKC,GACpBC,EAASC,KAAKH,GACdI,EAAQC,YAAY,SAAmB,UAATJ,GAC9BG,EAAQC,YAAY,OAAiB,QAATJ,GAG7B,QAASK,KACHC,OAAOC,cAQXT,EAAO,SAAU,QACjBK,EAAQK,MAAM,SAAUC,GACvBC,UAAUC,GAAGC,SACbH,EAAMI,qBAVPf,EAAO,sBAAuB,UAC9BK,EAAQK,MAAM,SAAUC,GACvBC,UAAUC,GAAGG,UACbL,EAAMI,oBAURV,EAAQY,QAGT,QAASC,GAASC,GACjBnB,EAAO,cAAe,QACtBoB,EAAEC,MACDC,KAAM,OACNC,IAAK,WACLC,MAAOL,UAAWA,GAClBM,SAAU,OACVC,SACCC,oCAAqC,GAEtCC,QAAS,SAAUC,GACdA,GAAqB,QAAdA,EAAIC,QACd9B,EAAO,WAAY,QACnBQ,OAAOuB,SAASC,QAAO,IAGvBhC,EAAO6B,EAAII,SAAS,iBAAkB,SAExCC,MAAO,SAAUL,GAChB7B,EAAO,iBAAkB,QACzBmC,QAAQD,MAAML,MAKjB,QAASO,KACRpC,EAAO,iBAAkB,QACzBoB,EAAEC,MACDC,KAAM,OACNC,IAAK,YACLC,MAAOa,KAAM7B,OAAO8B,QACpBb,SAAU,OACVC,SACCC,oCAAqC,GAEtCC,QAAS,SAAUC,GACdA,GAAqB,QAAdA,EAAIC,QACd9B,EAAO,cAAe,UACtBQ,OAAOuB,SAASC,QAAO,IAGvBhC,EAAO6B,EAAII,SAAS,iBAAkB,SAExCC,MAAO,SAAUL,GAChB7B,EAAO,iBAAkB,QACzBmC,QAAQD,MAAML,MAjFjB,GAAIT,GAAImB,QAAQ,UACfC,EAAUD,QAAQ,YAEflC,EAAUe,EAAE,WACfqB,KAAM,IACN5B,GAAI,eACJ6B,QAAO,sBACPC,KAAMC,aAAc,WAEjBzC,EAAWiB,EAAE,2BAA2ByB,SAASxC,EACrDA,GAAQwC,SAAS,aA4EjBL,EAAQ,uCACP,WACCjC,IACAK,UAAUC,GAAGiC,OACZrC,aAAcD,OAAOC,cAAgB,KACrCsC,QAAS7B,EACT8B,SAAUZ,MAIbhB,EAAE,WACD6B,IAAK,aACLR,KAAM,iCAELI,SAAS","file":"login.js","sourcesContent":["(function () {\n\tvar $ = require('jquery'),\n\t\t$script = require('scriptjs');\n\n\tvar $button = $('<a></a>', {\n\t\thref: '#',\n\t\tid: 'login-button',\n\t\tclass: 'persona-button dark',\n\t\tcss: {'margin-top': '0.5em'}\n\t});\n\tvar $caption = $('<span>Loading...</span>').appendTo($button);\n\t$button.appendTo('#identity');\n\n\tfunction inform(msg, color) {\n\t\t$caption.text(msg);\n\t\t$button.toggleClass('orange', color == 'orange');\n\t\t$button.toggleClass('dark', color == 'dark');\n\t}\n\n\tfunction setup_button() {\n\t\tif (!window.loggedInUser) {\n\t\t\tinform('Invoke your Persona', 'orange');\n\t\t\t$button.click(function (event) {\n\t\t\t\tnavigator.id.request();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tinform('Logout', 'blue');\n\t\t\t$button.click(function (event) {\n\t\t\t\tnavigator.id.logout();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t}\n\t\t$button.focus();\n\t}\n\n\tfunction on_login(assertion) {\n\t\tinform('Invoking...', 'dark');\n\t\t$.ajax({\n\t\t\ttype: 'POST',\n\t\t\turl: '../login',\n\t\t\tdata: {assertion: assertion},\n\t\t\tdataType: 'json',\n\t\t\theaders: {\n\t\t\t\t\"Access-Control-Allow-Credentials\" : true\n\t\t\t},\n\t\t\tsuccess: function (res) {\n\t\t\t\tif (res && res.status == 'okay') {\n\t\t\t\t\tinform('Success!', 'blue');\n\t\t\t\t\twindow.location.reload(true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tinform(res.message||'Unknown error.', 'dark');\n\t\t\t},\n\t\t\terror: function (res) {\n\t\t\t\tinform('Network error.', 'dark');\n\t\t\t\tconsole.error(res);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction on_logout() {\n\t\tinform('Logging out...', 'dark');\n\t\t$.ajax({\n\t\t\ttype: 'POST',\n\t\t\turl: '../logout',\n\t\t\tdata: {csrf: window.x_csrf},\n\t\t\tdataType: 'json',\n\t\t\theaders: {\n\t\t\t\t\"Access-Control-Allow-Credentials\" : true\n\t\t\t},\n\t\t\tsuccess: function (res) {\n\t\t\t\tif (res && res.status == 'okay') {\n\t\t\t\t\tinform('Logged out.', 'orange');\n\t\t\t\t\twindow.location.reload(true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tinform(res.message||'Unknown error.', 'dark');\n\t\t\t},\n\t\t\terror: function (res) {\n\t\t\t\tinform('Network error.', 'dark');\n\t\t\t\tconsole.error(res);\n\t\t\t}\n\t\t});\n\t}\n\n\t$script('https://login.persona.org/include.js',\n\t\tfunction () {\n\t\t\tsetup_button();\n\t\t\tnavigator.id.watch({\n\t\t\t\tloggedInUser: window.loggedInUser || null,\n\t\t\t\tonlogin: on_login,\n\t\t\t\tonlogout: on_logout\n\t\t\t});\n\t\t});\n\n\t$('<link/>', {\n\t\trel: 'stylesheet',\n\t\thref: '/ass/css/persona-buttons.css'\n\t})\n\t\t.appendTo('head');\n})();\n"],"sourceRoot":"/source/"}