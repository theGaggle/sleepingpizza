'use strict';System.register([],function(_export,_context){return {setters:[],execute:function(){let main=require('./main');let Article=main.posts.Article;let $=main.$;let Backbone=main.Backbone;let etc=main.etc;let options=main.options;let state=main.state;const mousemove=new Backbone.Model();let ImageHoverView=Backbone.View.extend({initialize(){this.listenTo(this.model,'change:event',this.check);main.reply('imager:clicked',() => this.$el.empty());},check(model,event){if(!options.get('imageHover'))return;var $target=$(event.target);if(!$target.is('img')||$target.hasClass('expanded'))return this.$el.children().remove("img,video");const src=$target.closest('a').attr('href'),isWebm=/\.webm$/.test(src);if(/\.pdf$/.test(src)||/\.mp3$/.test(src)||isWebm&&!options.get('webmHover'))return this.$el.empty();$(isWebm?'<video/>':'<img/>',{src:src,autoplay:true,loop:true}).appendTo(this.$el.empty());}});let PostPreview=Article.extend({initialize(args){this.parentNum=args.parentNum;this.listenTo(this.model,'dispatch',this.redirect).render().$el.addClass('preview');this.update();},update(){if(!this.num)this.num=etc.getID(this.el);postHover.render(this.$el,this.parentNum);}});let HoverPostView=Backbone.View.extend({initialize(){this.listenTo(this.model,'change:event',this.check);},check(model,event){let $target=$(event.target);if(!$target.is('a.history'))return;const m=$target.text().match(/^>>(\d+)/);if(!m)return;let post=state.posts.get(m[1]);if(!post)return;this.targetPos=$target.offset();this.previewView=new PostPreview({model:post,parentNum:etc.getID(event.target)});$target.one('mouseleave click',() => this.remove());},remove(){if(!this.previewView)return;this.targetPos=null;this.previewView.remove();this.stopListening(this.previewView);this.$el.children().remove('.preview');this.previewView=null;},render($el,num){$el.find('a.history').filter(function(){return this.text.includes('>>'+num);}).each(function(){$(this).addClass('referenced');});$el.css(this.position($el)).appendTo(this.$el.empty());},position($el){$el.hide();$(document.body).append($el);var w=$el.width();var h=$el.height();$el.detach().show();var $w=$(window);var l=this.targetPos.left-$w.scrollLeft();var t=this.targetPos.top-$w.scrollTop()-h-17;if(t<0)t+=h+34;var overflowR=l+w-$w.innerWidth();if(overflowR>-30)l=Math.max(0,l-overflowR-30);return {left:l,top:t};}});let ltarget,postHover;if(!main.isMobile){main.defer(function(){main.$doc.on('mousemove',function(e){if(e.target!=ltarget){mousemove.set('event',e);ltarget=e.target;}});let hover=document.getElementById('hover_overlay');new ImageHoverView({model:mousemove,el:hover});postHover=new HoverPostView({model:mousemove,el:hover});});}}};});
//# sourceMappingURL=maps/hover.js.map
