'use strict';System.register(['main'],function(_export,_context){var Backbone,options,state,$threads,$banner,events;return {setters:[function(_main){Backbone=_main.Backbone;options=_main.options;state=_main.state;$threads=_main.$threads;$banner=_main.$banner;events=_main.events;}],execute:function(){let atBottom,lockIndicator,isThread;function cacheState(){lockIndicator=document.query('#lock');isThread=!!state.posts.get('thread');}state.page.on('change',cacheState);cacheState();function checkBottom(){const height=document.body.scrollHeight-window.innerHeight;atBottom=height<=window.scrollY;if(lockIndicator){lockIndicator.style.visibility=atBottom?'visible':'hidden';}}checkBottom();document.addEventListener('scroll',checkBottom);let referenceEl;function followDOM(func){const previous=referenceDistance(),ret=func();if(atBottom&&(!document.hidden||options.get('alwaysLock'))){window.scrollTo(0,document.body.scrollHeight);}else {if(!elExists(referenceEl)){return ret;}const delta=topDistance(referenceEl,true)-previous;if(delta){window.scrollBy(0,delta);}}return ret;}_export('followDOM',followDOM);function elExists(el){return el&&document.contains(el);}function topDistance(el,skipCheck){var _el$getBoundingClient=el.getBoundingClientRect();const top=_el$getBoundingClient.top;if(skipCheck||top>=0&&top<window.innerHeight){return top;}return null;}function referenceDistance(){if(elExists(referenceEl)){const bounds=topDistance(referenceEl);if(bounds!==null){return bounds;}}for(let selector of ['article','section','threads']){for(let el of $threads.queryAll(selector)){const bounds=topDistance(el);if(bounds!==null){referenceEl=el;return bounds;}}}}function aboveBanner(){if(!/^#p\d+$/.test(location.hash)){return;}const anchor=document.query(location.hash);if(!anchor){return;}window.scrollTo(0,topDistance(anchor)-$banner.height);}events.reply('scroll:aboveBanner',aboveBanner);window.onload=aboveBanner;}};});
//# sourceMappingURL=maps/scroll.js.map
