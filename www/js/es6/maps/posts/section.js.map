{"version":3,"sources":["posts/section.js"],"names":[],"mappings":"u1CAkEY,mDAAO,KAAK,KAAL,CAAW,GAAX,CAAe,MAAf,mBACjB,yDAAa,KAAK,KAAL,CAAW,GAAX,CAAe,YAAf","file":"posts/section.js","sourcesContent":["/*\n * OP and thread related logic\n */\n\nconst main = require('../main'),\n\tPostCommon = require('./common'),\n\t{$, _, Backbone, util, oneeSama, state} = main;\n\nmodule.exports = PostCommon.extend({\n\ttagName: 'section',\n\trender() {\n\t\tconst attrs = this.model.attributes;\n\t\tthis.setElement(oneeSama.section(attrs)).insertIntoDOM();\n\n\t\t// Insert reply box into the new thread\n\t\tconst reply = util.parseDOM(oneeSama.replyBox());\n\t\tif (attrs.num in state.ownPosts || !!main.request('postForm'))\n\t\t\treply.style.display = 'none';\n\t\tthis.el.append(reply);\n\n\t\t// Remove next <hr>\n\t\tthis.el.nextElementSibling.remove();\n\t\treturn this;\n\t},\n\tinsertIntoDOM() {\n\t\tmain.$threads[0].query('aside')\n\t\t\t.after(this.el, document.createElement('hr'));\n\t\tthis.fun();\n\t},\n\trenderLocked(locked) {\n\t\tthis.el.classList[locked ? 'add' : 'remove']('locked');\n\t},\n\tremove() {\n\t\t// Remove next <hr>\n\t\tthis.el.nextElementSibling.remove();\n\t\tthis.el.remove();\n\t\tthis.stopListening();\n\t\treturn this;\n\t},\n\t/*\n\t Remove the top reply on board pages, if over limit, when a new reply is\n\t added\n\t */\n\tshiftReplies(postForm) {\n\t\tconst attrs = this.model.attributes,\n\t\t\t{replies} = attrs;\n\t\tlet lim = state.hotConfig.get('ABBREVIATED_REPLIES'),\n\t\t\tchanged;\n\t\tif (postForm)\n\t\t\tlim--;\n\t\t// Need a static length, because the original array get's modified\n\t\tconst len = replies.slice().length;\n\t\tfor (let i = len; i > lim; i--) {\n\t\t\tconst post = state.posts.get(replies.shift());\n\t\t\tif (!post)\n\t\t\t\tcontinue;\n\t\t\tif (post.get('image'))\n\t\t\t\tattrs.image_omit++;\n\t\t\tattrs.omit++;\n\t\t\tchanged = true;\n\t\t\tpost.remove();\n\t\t}\n\t\tif (changed)\n\t\t\tthis.renderOmit(attrs.omit, attrs.image_omit)\n\t},\n\t// Posts and images omited indicator\n\trenderOmit(omit = this.model.get('omit'),\n\t\timage_omit = this.model.get('image_omit')\n\t) {\n\t\tif (omit === 0)\n\t\t\treturn;\n\t\tconst {thread, href} = state.page.attributes;\n\t\tthis.el.query('.omit').innerHTML = oneeSama.lang.abbrev_msg(omit,\n\t\t\tthis.model.get('image_omit'), thread && href.split('?')[0]);\n\t},\n\t// Move thread to the top of the page\n\tbumpThread() {\n\t\tthis.el.nextElementSibling.remove();\n\t\tthis.el.remove();\n\t\tthis.insertIntoDOM();\n\t}\n});\n"],"sourceRoot":"/source/"}