'use strict';System.register(['lang','../../state','underscore','../../options','../../util'],function(_export,_context){var lang,config,escape,options,parseHTML,commaList;return {setters:[function(_lang){lang=_lang.default;},function(_state){config=_state.config;},function(_underscore){escape=_underscore.escape;},function(_options){options=_options.default;},function(_util){parseHTML=_util.parseHTML;commaList=_util.commaList;}],execute:function(){var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally {try{if(!_n&&_i["return"])_i["return"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();function renderImage(data,reveal){const showThumb=options.get("thumbs")!=='hide'||reveal;return parseHTML`<figure>
			${ renderFigcaption(data,reveal) }
			${ config.images.hat&&showThumb?'<span class="hat"></span>':'' }
			${ showThumb?renderThumbnail(data):'' }
		</figure>`;}_export('renderImage',renderImage);function renderFigcaption(data,reveal){const list=commaList([data.audio?'\u266B':'',data.length,readableFilesize(data.size),`${ data.dims[0] }x${ data.dims[1] }`,data.apng?'APNG':'']);return parseHTML`<figcaption>
			${ hiddenToggle(reveal) }
			${ imageSearch(data) }
			<span>
				(${ list })
			</span>
			${ imageLink(data) }
		</figcaption>`;}_export('renderFigcaption',renderFigcaption);function readableFilesize(size){if(size<1024){return size+' B';}if(size<1048576){return Math.round(size/1024)+' KB';}size=Math.round(size/104857.6).toString();return size.slice(0,-1)+'.'+size.slice(-1)+' MB';}function hiddenToggle(reveal){if(options.get('thumbs')!=='hide'){return '';}return parseHTML`<a class="imageToggle">
			[${ lang[reveal?'hide':'show'] }]
		</a>`;}const imagePaths={src:'/img/src/',thumb:'/img/thumb/',mid:'/img/mid/',spoil:'/ass/spoil/spoiler'};const searchTemplates=function(){const models=[{engine:'google',url:'https://www.google.com/searchbyimage?image_url=',type:'thumb',symbol:'G'},{engine:'iqdb',url:'http://iqdb.org/?url=',type:'thumb',symbol:'Iq'},{engine:'saucenao',url:'http://saucenao.com/search.php?db=999&url=',type:'thumb',symbol:'Sn'},{engine:'desustorage',type:'MD5',url:'https://desustorage.org/_/search/image/',symbol:'Ds'},{engine:'exhentai',type:'SHA1',url:'http://exhentai.org/?fs_similar=1&fs_exp=1&f_shash=',symbol:'Ex'}];const templates={};for(let _ref of models){let engine=_ref.engine;let url=_ref.url;let type=_ref.type;let symbol=_ref.symbol;const attrs={target:'_blank',rel:'nofollow',class:'imageSearch '+engine};templates[engine]=data => {if(!options.get(engine)){return '';}attrs.href=url+(type==='thumb'?thumbPath(data):data[type]);return parseHTML`<a ${ parseAttributes(attrs) }>
					${ symbol }
				</a>`;};}return templates;}();function imageSearch(data){let html='';if(['.pdf','.mp3'].indexOf(data.ext)>-1){if(options.get("google")){return searchTemplates.google(data);}return '';}for(let engine in searchTemplates){html+=searchTemplates[engine](data);}return html;}function thumbPath(data,mid){return imagePaths[type]+data[mid&&data.mid?'mid':'thumb'];}function imageLink(data){let name='';var _imgnm=imgnm;let imgnm=_imgnm.imgnm;const m=imgnm.match(/^(.*)\.\w{3,4}$/);if(m){name=m[1];}const fullName=escape(imgnm),tooLong=name.length>=38;if(tooLong){imgnm=escape(name.slice(0,30))+'(&hellip;)'+escape(data.ext);}const attrs={href:`${ config.SECONDARY_MEDIA_URL }src/${ data.src }`,rel:'nofollow',download:fullName};if(tooLong){attrs.title=fullName;}return parseHTML`<a ${ parseAttributes(attrs) }>
			${ imgnm }
		</a>`;}function renderHat(showThumb){if(showThumb&&config.images.hats){return '<span class="hat"></span>';}return '';}function renderThumbnail(data,href){let src=imagePaths.src+data.src;let thumb;var _data$dims=_slicedToArray(data.dims,4);let width=_data$dims[0];let height=_data$dims[1];let thumbWidth=_data$dims[2];let thumbHeight=_data$dims[3];if(data.spoiler&&options.get('spoilers')){const sp=spoilerInfo(data);thumb=sp.thumb;thumbWidth=sp.dims[0];thumbHeight=sp.dims[1];}else if(data.ext==='.gif'&&options.get('autogif')){thumb=src;}else {thumb=thumbPath(data,options.get('thumbs')!=='small');}const linkAttrs={target:'_blank',rel:'nofollow',href:href||src};const imgAttrs={src:thumb,width:thumbWidth,height:thumbHeight};if(href){linkAttrs.class='history';imgAttrs.class='expanded';if(this.thumbStyle=='hide'){imgAttrs.style='display: none';}}return parseHTML`<a ${ parseAttributes(linkAttrs) }>
			<img ${ parseAttributes(imgAttrs) }>
		</a>`;}_export('renderThumbnail',renderThumbnail);function spoilerInfo(_ref2){let largeThumb=_ref2.largeThumb;let spoiler=_ref2.spoiler;let thumb=imagePaths.spoil;if(largeThumb||options.get("thumbs")!=='small'){thumb+='s';}html+=spoiler+'.png';return {thumb,dims:config.images.thumb[largeThumb?'midDims':'thumbDims']};}}};});
//# sourceMappingURL=../../maps/posts/render/image.js.map
