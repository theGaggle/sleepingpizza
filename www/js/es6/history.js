'use strict';System.register([],function(_export,_context){return {setters:[],execute:function(){let main=require('./main');let $=main.$;let _=main._;let common=main.common;let Extract=main.Extract;let state=main.state;main.$doc.on('click','a.history',function(event){if(event.ctrlKey)return;readingSteiner(this.href,event);});let $loading=$('#loadingImage');main.reply('loading:show',() => $loading.show());main.reply('loading:hide',() => $loading.hide());function readingSteiner(url,event){let nextState=state.read(url);if(_.isMatch(state.page.attributes,nextState))return;main.request('connection:lock');if(event)event.preventDefault();const split=url.split('#');let address=split[0]+(/\?/.test(split[0])?'&':'?')+'minimal=true';if(split.length!==1)address+='#'+split[1];$loading.show();const xhr=new XMLHttpRequest();xhr.open('GET',address);xhr.onload=function(){if(this.status!==200){$loading.hide();return alert(this.status);}if(baseURL(url)!==baseURL(this.responseURL))nextState=state.read(this.responseURL);main.request('postSM:feed','done');main.trigger('state:clear');main.$threads[0].innerHTML=this.response;state.page.set(nextState);main.oneeSama.op=nextState.thread;new Extract(nextState.catalog);if(!nextState.catalog){main.request('connection:unlock',[common.RESYNC,nextState.board,state.syncs,nextState.live]);}if(event){history.pushState(null,null,nextState.href);if(location.hash)main.request('scroll:aboveBanner');else window.scrollTo(0,0);}$loading.hide();};xhr.send();}function baseURL(url){return url.split(/[\?#]/)[0];}window.onpopstate=function(event){readingSteiner(event.target.location.href);main.request('scroll:aboveBanner');};}};});
//# sourceMappingURL=maps/history.js.map
