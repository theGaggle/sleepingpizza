"use strict";System.register([],function(e,t){var n,i,o,s,c,r,a,u,d,h,f,l,p,g;return{setters:[],execute:function(){n=require("./main"),i=n.$,o=n._,s=n.Backbone,c=n.config,r=n.connSM,a=n.etc,u=n.state,d=n.options,h="",f=new XMLHttpRequest,f.open("GET","/ass/css/ui/disconnected.ico"),f.responseType="blob",f.onload=function(){200===this.status&&(h=window.URL.createObjectURL(this.response))},f.send(),l=s.Model.extend({initialize:function(){var e=this;this.$favicon=i("#favicon"),this.check(this),this.listenTo(this,"change",this.check),n.reply("post:inserted",function(t){t.get("mine")||document.hidden&&e.set("unreadCount",e.get("unreadCount")+1)}),n.reply("notify:title",function(t){return e.set("title",t)}),document.addEventListener("visibilitychange",function(t){var n=t.target.hidden;e.set({hidden:n,unreadCount:0,reply:!n})},!1);var t=function(){return e.set("alert",!0)};r.on("dropped",t),r.on("desynced",t),r.on("synced",function(){return p.set("alert",!1)})},check:function(e){var t=e.attributes,n=t.hidden,i=t.unreadCount,o=t.reply,s=t.alert,c="/ass/favicon.ico";if(s)return this.render(h,"--- ");if(!n)return this.render(c,"");var r="";i&&(r+="("+i+") ",c="/ass/css/ui/unreadFavicon.ico"),o&&(r=">> "+r,c="/ass/css/ui/replyFavicon.ico"),this.render(c,r)},render:function(e,t){document.title=t+this.get("title"),this.$favicon.attr("href",e)}}),p=new l({unreadCount:0,title:document.title}),g=new n.Memory("replies",3),n.reply("repliedToMe",function(e){var t=u.posts.get(e);if(t&&(t=t.attributes,!(e in g.readAll()))){if(d.get("notification")&&document.hidden&&!n.isMobile){var i=new Notification(n.lang.quoted,{icon:t.image&&"hide"!==d.get("thumbs")&&!n.oneeSama.workMode?n.oneeSama.thumbPath(t.image):"/ass/css/ui/favbig.png",body:t.body});i.onclick=function(){window.focus(),location.hash="#p"+e}}p.set({reply:!0}),g.write(e)}}),n.reply("time:syncwatch",function(){d.get("notification")&&document.hidden&&(new Notification(n.lang.syncwatchStarting).onclick=function(){return window.focus()})})}}});
//# sourceMappingURL=maps/notify.js.map
