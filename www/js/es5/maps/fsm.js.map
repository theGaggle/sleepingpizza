{"version":3,"sources":["fsm.js"],"names":["System","register","_export","_context","_classCallCheck","instance","Constructor","TypeError","_createClass","FSM","setters","execute","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","start","this","state","spec","acts","ons","wilds","preflights","value","second","f","push","pres","trans_spec","on_func","halves","split","Error","parts","dest","match","tok","undefined","part","m","src","on","ev","param","from","to","ps","call","fs","_this","feed"],"mappings":"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","file":"fsm.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var _createClass,FSM;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}return {setters:[],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();FSM=function(){function FSM(start){_classCallCheck(this,FSM);this.state=start;this.spec={acts:{},ons:{},wilds:{},preflights:{}};}_createClass(FSM,[{key:'clone',value:function clone(){var second=new FSM(this.state);second.spec=this.spec;return second;}},{key:'on',value:function on(key,f){var ons=this.spec.ons[key];if(ons){ons.push(f);}else {this.spec.ons[key]=[f];}}},{key:'preflight',value:function preflight(key,f){var pres=this.spec.preflights[key];if(pres){pres.push(f);}else {this.spec.preflights[key]=[f];}}},{key:'act',value:function act(trans_spec,on_func){var halves=trans_spec.split('->');if(halves.length!=2){throw new Error(\"Bad FSM spec: \"+trans_spec);}var parts=halves[0].split(','),dest=halves[1].match(/^\\s*(\\w+)\\s*$/)[1];var tok=undefined;for(var i=parts.length-1;i>=0;i--){var part=parts[i],m=part.match(/^\\s*(\\*|\\w+)\\s*(?:\\+\\s*(\\w+)\\s*)?$/);if(!m){throw new Error(\"Bad FSM spec portion: \"+part);}if(m[2]){tok=m[2];}if(!tok){throw new Error(\"Tokenless FSM action: \"+part);}var src=m[1];if(src=='*'){this.spec.wilds[tok]=dest;}else {var acts=this.spec.acts[src];if(!acts){this.spec.acts[src]=acts={};}acts[tok]=dest;}}if(on_func){this.on(dest,on_func);}}},{key:'feed',value:function feed(ev,param){var spec=this.spec;var from=this.state;var acts=spec.acts[from];var to=acts&&acts[ev]||spec.wilds[ev];if(to&&from!=to){var ps=spec.preflights[to];for(var i=0;ps&&i<ps.length;i++){if(!ps[i].call(this,param)){return false;}}this.state=to;var fs=spec.ons[to];for(var i=0;fs&&i<fs.length;i++){fs[i].call(this,param);}}return true;}},{key:'feeder',value:function feeder(ev){var _this=this;return function(param){return _this.feed(ev,param);};}}]);return FSM;}();_export('default',FSM);}};});"],"sourceRoot":"/source/"}