{"version":3,"sources":["extract.js"],"names":["System","register","_export","_context","_classCallCheck","instance","Constructor","TypeError","_createClass","main","_","util","options","state","posts","Extract","setters","execute","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","require","catalog","this","el","$threads","json","JSON","parse","document","getElementById","innerHTML","request","title","mine","readAll","extractReplies","extractThreads","addLinks","links","post","num","get","value","articles","getElementsByTagName","l","article","Article","model","models","Post","extractModel","sections","section","Section","Thread","renderOmit","syncs","hctr","info","getNum","module","exports","page"],"mappings":"AAAA,YAAaA,QAAOC,YAAY,SAASC,EAAQC,GAAmE,QAASC,GAAgBC,EAASC,GAAa,KAAKD,YAAoBC,IAAc,KAAM,IAAIC,WAAU,qCAAnK,GAAIC,GAAaC,EAAKC,EAAEC,EAAKC,EAAQC,EAAMC,EAAMC,CAAyJ,QAAQC,WAAWC,QAAQ,WAAWT,EAAa,WAAW,QAASU,GAAiBC,EAAOC,GAAO,IAAI,GAAIC,GAAE,EAAEA,EAAED,EAAME,OAAOD,IAAI,CAAC,GAAIE,GAAWH,EAAMC,EAAGE,GAAWC,WAAWD,EAAWC,aAAY,EAAMD,EAAWE,cAAa,EAAQ,SAAWF,KAAWA,EAAWG,UAAS,GAAKC,OAAOC,eAAeT,EAAOI,EAAWM,IAAIN,IAAc,MAAO,UAASjB,EAAYwB,EAAWC,GAAuI,MAAvHD,IAAWZ,EAAiBZ,EAAY0B,UAAUF,GAAeC,GAAYb,EAAiBZ,EAAYyB,GAAoBzB,MAAkBG,EAAKwB,QAAQ,UAAUvB,EAAED,EAAKC,EAAEC,EAAKF,EAAKE,KAAKC,EAAQH,EAAKG,QAAQC,EAAMJ,EAAKI,MAAMC,EAAML,EAAKK,MAAMC,EAAQ,WAAW,QAASA,GAAQmB,GAAS9B,EAAgB+B,KAAKpB,EAAS,IAAIqB,GAAG3B,EAAK4B,SAAS,GAAOC,EAAKC,KAAKC,MAAMC,SAASC,eAAe,YAAYC,UAAmD,IAAxClC,EAAKmC,QAAQ,eAAeN,EAAKO,QAAUX,EAAH,CAAkB,GAAIY,GAAKX,KAAKW,KAAKjC,EAAMiC,KAAKC,UAAUjC,EAAMqB,KAAKrB,MAAMwB,EAAKxB,KAAMqB,MAAKa,eAAeZ,GAAID,KAAKc,eAAeb,GAAIvB,EAAMqC,SAASZ,EAAKa,MAAO,KAAI,GAAIC,KAAQtC,GAAM,CAAC,GAAIqC,GAAMrC,EAAMsC,GAAMD,KAAM,IAAIA,EAAe,IAAI,GAAIE,KAAOF,GAAUE,IAAOP,IAAKrC,EAAKmC,QAAQ,cAAc9B,EAAMsC,GAAMC,KAAUzC,EAAQ0C,IAAI,cAAa7C,EAAKmC,QAAQ,kBAAkBnC,EAAKmC,QAAQ,gBAA2vB,MAA3uBpC,GAAaO,IAAUc,IAAI,iBAAiB0B,MAAM,SAAwBnB,GAAoD,IAAI,GAAhDoB,GAASpB,EAAGqB,qBAAqB,WAAmBpC,EAAE,EAAEqC,EAAEF,EAASlC,OAASoC,EAAFrC,EAAIA,IAAI,CAAC,GAAIsC,GAAQH,EAASnC,EAAG,IAAIP,GAAM8C,SAASC,MAAM,GAAI/C,GAAMgD,OAAOC,KAAK5B,KAAK6B,aAAaL,IAAUvB,GAAGuB,QAAe9B,IAAI,iBAAiB0B,MAAM,SAAwBnB,GAAoD,IAAI,GAAhD6B,GAAS7B,EAAGqB,qBAAqB,WAAmBpC,EAAE,EAAEA,EAAE4C,EAAS3C,OAAOD,IAAI,CAAC,GAAI6C,GAAQD,EAAS5C,GAAOwC,EAAM1B,KAAK6B,aAAaE,EAAS,IAAIpD,GAAMqD,SAASN,MAAM,GAAI/C,GAAMgD,OAAOM,OAAOP,GAAOzB,GAAG8B,IAAUG,aAAaxD,EAAMyD,MAAMT,EAAMR,KAAKQ,EAAMU,SAAU1C,IAAI,eAAe0B,MAAM,SAAsBnB,GAAI,GAAIoC,GAAKrC,KAAKrB,MAAMH,EAAK8D,OAAOrC,GAA6C,OAArCoC,GAAKnB,MAAOlB,MAAKW,OAAK0B,EAAK1B,MAAK,GAAY0B,MAAiBzD,KAAY2D,OAAOC,QAAQ5D,EAAQ,GAAIA,GAAQF,EAAM+D,KAAKtB,IAAI","file":"extract.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var _createClass,main,_,util,options,state,posts,Extract;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}return {setters:[],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();main=require('./main');_=main._;util=main.util;options=main.options;state=main.state;posts=main.posts;Extract=function(){function Extract(catalog){_classCallCheck(this,Extract);var el=main.$threads[0];var json=JSON.parse(document.getElementById('postData').innerHTML);main.request('notify:title',json.title);if(catalog)return;var mine=this.mine=state.mine.readAll(),posts=this.posts=json.posts;this.extractReplies(el);this.extractThreads(el);state.addLinks(json.links);for(var post in posts){var links=posts[post].links;if(!links)continue;for(var num in links){if(num in mine)main.request('repliedToMe',posts[post].num);}}if(options.get('anonymise'))main.request('loop:anonymise');main.request('time:render');}_createClass(Extract,[{key:'extractReplies',value:function extractReplies(el){var articles=el.getElementsByTagName('article');for(var i=0,l=articles.length;i<l;i++){var article=articles[i];new posts.Article({model:new posts.models.Post(this.extractModel(article)),el:article});}}},{key:'extractThreads',value:function extractThreads(el){var sections=el.getElementsByTagName('section');for(var i=0;i<sections.length;i++){var section=sections[i];var model=this.extractModel(section);new posts.Section({model:new posts.models.Thread(model),el:section}).renderOmit();state.syncs[model.num]=model.hctr;}}},{key:'extractModel',value:function extractModel(el){var info=this.posts[util.getNum(el)];if(info.num in this.mine)info.mine=true;return info;}}]);return Extract;}();module.exports=Extract;new Extract(state.page.get('catalog'));}};});"],"sourceRoot":"/source/"}