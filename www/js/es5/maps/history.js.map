{"version":3,"sources":["history.js"],"names":["System","register","_export","_context","readingSteiner","url","event","nextState","state","read","_","isMatch","page","attributes","main","request","preventDefault","split","address","test","length","$loading","show","xhr","XMLHttpRequest","open","onload","this","status","hide","alert","baseURL","responseURL","trigger","$threads","innerHTML","response","set","oneeSama","op","thread","Extract","catalog","common","RESYNC","board","syncs","live","history","pushState","href","location","hash","window","scrollTo","send","$","setters","execute","require","$doc","on","ctrlKey","reply","onpopstate","target"],"mappings":"AAAA,YAAaA,QAAOC,YAAY,SAASC,EAAQC,GAAqD,QAASC,GAAeC,EAAIC,GAAO,GAAIC,GAAUC,EAAMC,KAAKJ,EAAK,KAAGK,EAAEC,QAAQH,EAAMI,KAAKC,WAAWN,GAAnC,CAAqDO,EAAKC,QAAQ,mBAAsBT,GAAMA,EAAMU,gBAAiB,IAAIC,GAAMZ,EAAIY,MAAM,KAASC,EAAQD,EAAM,IAAI,KAAKE,KAAKF,EAAM,IAAI,IAAI,KAAK,cAAiC,KAAfA,EAAMG,SAAWF,GAAS,IAAID,EAAM,IAAGI,EAASC,MAAO,IAAIC,GAAI,GAAIC,eAAiBD,GAAIE,KAAK,MAAMP,GAASK,EAAIG,OAAO,WAAW,MAAiB,OAAdC,KAAKC,QAAcP,EAASQ,OAAcC,MAAMH,KAAKC,UAAYG,EAAQ1B,KAAO0B,EAAQJ,KAAKK,eAAazB,EAAUC,EAAMC,KAAKkB,KAAKK,cAAalB,EAAKC,QAAQ,cAAc,QAAQD,EAAKmB,QAAQ,eAAenB,EAAKoB,SAAS,GAAGC,UAAUR,KAAKS,SAAS5B,EAAMI,KAAKyB,IAAI9B,GAAWO,EAAKwB,SAASC,GAAGhC,EAAUiC,OAAO,GAAIC,GAAQlC,EAAUmC,SAAanC,EAAUmC,SAAS5B,EAAKC,QAAQ,qBAAqB4B,EAAOC,OAAOrC,EAAUsC,MAAMrC,EAAMsC,MAAMvC,EAAUwC,OAAWzC,IAAO0C,QAAQC,UAAU,KAAK,KAAK1C,EAAU2C,MAASC,SAASC,KAAKtC,EAAKC,QAAQ,sBAA2BsC,OAAOC,SAAS,EAAE,QAAIjC,GAASQ,SAASN,EAAIgC,QAAQ,QAASxB,GAAQ1B,GAAK,MAAOA,GAAIY,MAAM,SAAS,GAAhmC,GAAIH,GAAK0C,EAAE9C,EAAEiC,EAAOF,EAAQjC,EAAMa,CAAkkC,QAAQoC,WAAWC,QAAQ,WAAW5C,EAAK6C,QAAQ,UAAUH,EAAE1C,EAAK0C,EAAE9C,EAAEI,EAAKJ,EAAEiC,EAAO7B,EAAK6B,OAAOF,EAAQ3B,EAAK2B,QAAQjC,EAAMM,EAAKN,MAAMM,EAAK8C,KAAKC,GAAG,QAAQ,YAAY,SAASvD,GAAUA,EAAMwD,SAAe1D,EAAeuB,KAAKuB,KAAK5C,KAAUe,EAASmC,EAAE,iBAAiB1C,EAAKiD,MAAM,eAAe,WAAW,MAAO1C,GAASC,SAAUR,EAAKiD,MAAM,eAAe,WAAW,MAAO1C,GAASQ,SAAUwB,OAAOW,WAAW,SAAS1D,GAAOF,EAAeE,EAAM2D,OAAOd,SAASD,MAAMpC,EAAKC,QAAQ","file":"history.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var main,$,_,common,Extract,state,$loading;function readingSteiner(url,event){var nextState=state.read(url);if(_.isMatch(state.page.attributes,nextState))return;main.request('connection:lock');if(event)event.preventDefault();var split=url.split('#');var address=split[0]+(/\\?/.test(split[0])?'&':'?')+'minimal=true';if(split.length!==1)address+='#'+split[1];$loading.show();var xhr=new XMLHttpRequest();xhr.open('GET',address);xhr.onload=function(){if(this.status!==200){$loading.hide();return alert(this.status);}if(baseURL(url)!==baseURL(this.responseURL))nextState=state.read(this.responseURL);main.request('postSM:feed','done');main.trigger('state:clear');main.$threads[0].innerHTML=this.response;state.page.set(nextState);main.oneeSama.op=nextState.thread;new Extract(nextState.catalog);if(!nextState.catalog){main.request('connection:unlock',[common.RESYNC,nextState.board,state.syncs,nextState.live]);}if(event){history.pushState(null,null,nextState.href);if(location.hash)main.request('scroll:aboveBanner');else window.scrollTo(0,0);}$loading.hide();};xhr.send();}function baseURL(url){return url.split(/[\\?#]/)[0];}return {setters:[],execute:function(){main=require('./main');$=main.$;_=main._;common=main.common;Extract=main.Extract;state=main.state;main.$doc.on('click','a.history',function(event){if(event.ctrlKey)return;readingSteiner(this.href,event);});$loading=$('#loadingImage');main.reply('loading:show',function(){return $loading.show();});main.reply('loading:hide',function(){return $loading.hide();});window.onpopstate=function(event){readingSteiner(event.target.location.href);main.request('scroll:aboveBanner');};}};});"],"sourceRoot":"/source/"}