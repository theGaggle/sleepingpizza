{"version":3,"sources":["drop.js"],"names":["System","register","_export","_context","dragonDrop","e","stopPropagation","preventDefault","files","dataTransfer","length","postForm","main","request","attrs","model","attributes","uploading","uploaded","thread","state","page","get","section","target","closest","etc","getNum","uploadError","extra","prepareUpload","data","FormData","append","key","xhr","XMLHttpRequest","open","uploadURL","setRequestHeader","onreadystatechange","upload_shita","send","notifyUploading","this","readyState","status","err","responseText","test","stop_drag","setupUploadDrop","el","go","name","func","addEventListener","setters","execute","require","isMobile","defer","$threads"],"mappings":"AAAA,YAAaA,QAAOC,YAAY,SAASC,EAAQC,GAA6B,QAASC,GAAWC,GAAGA,EAAEC,kBAAkBD,EAAEE,gBAAiB,IAAIC,GAAMH,EAAEI,aAAaD,KAAM,IAAIA,EAAME,OAAV,CAAwB,GAAIC,GAASC,EAAKC,QAAQ,WAAY,IAAIF,EAA2M,CAAC,GAAIG,GAAMH,EAASI,MAAMC,UAAW,IAAGF,EAAMG,WAAWH,EAAMI,SAAS,WAA1Q,CAAC,GAAIC,GAAOC,EAAMC,KAAKC,IAAI,SAAU,IAAGH,EAAOP,EAAKC,QAAQ,cAAcM,OAAa,CAAC,GAAII,GAAQlB,EAAEmB,OAAOC,QAAQ,UAAcF,IAAQX,EAAKC,QAAQ,cAAca,EAAIC,OAAOJ,KAAgJ,GAA3CZ,IAASA,EAASC,EAAKC,QAAQ,aAAeL,EAAME,OAAO,EAA2C,WAAxCC,GAASiB,YAAY,kBAA2B,IAAIC,GAAMlB,EAASmB,gBAAgBC,EAAK,GAAIC,SAAWD,GAAKE,OAAO,QAAQzB,EAAM,GAAI,KAAI,GAAI0B,KAAOL,GAAOE,EAAKE,OAAOC,EAAIL,EAAMK,GAAO,IAAIC,GAAI,GAAIC,eAAiBD,GAAIE,KAAK,OAAOX,EAAIY,aAAaH,EAAII,iBAAiB,SAAS,oBAAoBJ,EAAIK,mBAAmBC,EAAaN,EAAIO,KAAKX,GAAMpB,EAASgC,mBAAmB,QAASF,KAAe,GAAoB,GAAjBG,KAAKC,YAA4B,KAAbD,KAAKE,OAA5B,CAA+C,GAAIC,GAAIH,KAAKI,YAAiB,8BAA6BC,KAAKF,IAAKnC,EAAKC,QAAQ,YAAYe,YAAYmB,IAAM,QAASG,GAAU7C,GAAGA,EAAEC,kBAAkBD,EAAEE,iBAAkB,QAAS4C,GAAgBC,GAAsG,QAASC,GAAGC,EAAKC,GAAMH,EAAGI,iBAAiBF,EAAKC,GAAK,GAAvJF,EAAG,YAAYH,GAAWG,EAAG,WAAWH,GAAWG,EAAG,WAAWH,GAAWG,EAAG,OAAOjD,GAA9uC,GAAIQ,GAAKc,EAAIN,CAA2yC,QAAQqC,WAAWC,QAAQ,WAAW9C,EAAK+C,QAAQ,UAAUjC,EAAId,EAAKc,IAAIN,EAAMR,EAAKQ,MAAUR,EAAKgD,UAAShD,EAAKiD,MAAM,WAAW,MAAOV,GAAgBvC,EAAKkD,SAAS","file":"drop.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var main,etc,state;function dragonDrop(e){e.stopPropagation();e.preventDefault();var files=e.dataTransfer.files;if(!files.length)return;var postForm=main.request('postForm');if(!postForm){var thread=state.page.get('thread');if(thread)main.request('openPostBox',thread);else {var section=e.target.closest('section');if(section)main.request('openPostBox',etc.getNum(section));}}else {var attrs=postForm.model.attributes;if(attrs.uploading||attrs.uploaded)return;}if(!postForm)postForm=main.request('postForm');if(files.length>1){postForm.uploadError('Too many files.');return;}var extra=postForm.prepareUpload(),data=new FormData();data.append('image',files[0]);for(var key in extra){data.append(key,extra[key]);}var xhr=new XMLHttpRequest();xhr.open('POST',etc.uploadURL());xhr.setRequestHeader('Accept','application/json');xhr.onreadystatechange=upload_shita;xhr.send(data);postForm.notifyUploading();}function upload_shita(){if(this.readyState!=4||this.status==202)return;var err=this.responseText;if(!/legitimate imager response/.test(err))main.request('postForm').uploadError(err);}function stop_drag(e){e.stopPropagation();e.preventDefault();}function setupUploadDrop(el){go('dragenter',stop_drag);go('dragexit',stop_drag);go('dragover',stop_drag);go('drop',dragonDrop);function go(name,func){el.addEventListener(name,func,false);}}return {setters:[],execute:function(){main=require('./main');etc=main.etc;state=main.state;if(!main.isMobile)main.defer(function(){return setupUploadDrop(main.$threads[0]);});}};});"],"sourceRoot":"/source/"}