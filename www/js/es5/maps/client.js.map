{"version":3,"sources":["client.js"],"names":["System","register","_export","_context","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","checkRepliedToMe","links","sourceNum","mine","state","readAll","num","main","request","modelHandler","func","model","posts","get","_$extend","_slicedToArray","_","common","dispatcher","util","online","setters","execute","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","length","err","Array","isArray","TypeError","require","document","query","extend","INSERT_POST","message","_message","msg","bump","page","isThread","op","syncs","editing","el","nonce","myNonce","tab","ownPosts","oneeSama","trigger","postSM","feed","postForm","write","addLinks","models","view","id","render","insertIntoDOM","clientInit","parent","dispatch","INSERT_IMAGE","_msg","img","postModel","toPostForm","insertUploaded","setImage","UPDATE_POST","_ref","_ref2","frag","_ref2$","extra","update","FINISH_POST","_msg2","set","DELETE_POSTS","deletePost","LOCK_THREAD","toggleLocked","UNLOCK_THREAD","DELETE_IMAGES","removeImage","SPOILER_IMAGES","setSpoiler","BAN","_msg3","info","JSON","parse","setBan","BACKLINK","addBacklink","ONLINE_COUNT","textContent","HOT_INJECTION","_msg4","force","hash","hotConfig","configHash","send","SYNCHRONIZE","connSM","feeder","INVALID","listener","event","spoilt","target","classList","toggle"],"mappings":"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","file":"client.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var _$extend,_slicedToArray,main,_,common,dispatcher,util,posts,state,online;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj;}function checkRepliedToMe(links,sourceNum){if(!links)return;var mine=state.mine.readAll();for(var num in links){if(num in mine)main.request('repliedToMe',sourceNum);}}function modelHandler(num,func){var model=state.posts.get(num);if(model)func(model);}return {setters:[],execute:function(){_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally {try{if(!_n&&_i[\"return\"])_i[\"return\"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");}};}();main=require('./main');_=main._;common=main.common;dispatcher=main.dispatcher;util=main.util;posts=main.posts;state=main.state;online=document.query('#onlineCount');_.extend(dispatcher,(_$extend={},_defineProperty(_$extend,common.INSERT_POST,function(message){var _message=_slicedToArray(message,2);var msg=_message[0];var bump=_message[1];bump=bump&&state.page.get('live');var isThread=!msg.op;var num=msg.num;if(isThread)state.syncs[num]=1;msg.editing=true;var el=undefined;var nonce=msg.nonce;delete msg.nonce;var myNonce=main.request('nonce:get')[nonce];if(myNonce&&myNonce.tab===state.page.get('tabID')){state.ownPosts[num]=true;main.oneeSama.trigger('insertOwnPost',msg);main.postSM.feed('alloc',msg);bump=false;main.request('nonce:destroy',nonce);var postForm=main.request('postForm');if(postForm&&postForm.el)el=postForm.el;}if(myNonce){msg.mine=true;state.mine.write(num);}state.addLinks(msg.links);var model=new posts.models[isThread?'Thread':'Post'](msg);var view=new posts[isThread?'Section':'Article']({model:model,el:el,id:num});if(!el)view.render().insertIntoDOM();view.clientInit();checkRepliedToMe(msg.links,num);main.request('post:inserted',model);if(isThread)return;var parent=state.posts.get(msg.op);if(!parent)return;parent.get('replies').push(num);if(state.page.get('thread'))return;parent.dispatch('shiftReplies');if(bump)parent.dispatch('bumpThread');}),_defineProperty(_$extend,common.INSERT_IMAGE,function(msg){var _msg=_slicedToArray(msg,2);var num=_msg[0];var img=_msg[1];var postModel=main.request('postModel'),toPostForm=postModel&&postModel.get('num')==num;if(toPostForm)main.request('postForm').insertUploaded(img);modelHandler(num,function(model){return model.setImage(img,toPostForm);});}),_defineProperty(_$extend,common.UPDATE_POST,function(_ref){var _ref2=_slicedToArray(_ref,3);var num=_ref2[0];var frag=_ref2[1];var _ref2$=_ref2[2];var extra=_ref2$===undefined?{}:_ref2$;modelHandler(num,function(model){state.addLinks(extra.links);model.update(frag,extra);checkRepliedToMe(extra.links,num);if(num in state.ownPosts)main.oneeSama.trigger('insertOwnPost',extra);else model.dispatch('updateBody',frag);});}),_defineProperty(_$extend,common.FINISH_POST,function(msg){var _msg2=_slicedToArray(msg,1);var num=_msg2[0];delete state.ownPosts[num];modelHandler(num,function(model){model.set('editing',false);model.dispatch('renderEditing',false);});}),_defineProperty(_$extend,common.DELETE_POSTS,function(msg){modelHandler(msg[0],function(model){return model.deletePost(msg[1]);});}),_defineProperty(_$extend,common.LOCK_THREAD,function(msg){modelHandler(msg[0],function(model){return model.toggleLocked(true,msg[1]);});}),_defineProperty(_$extend,common.UNLOCK_THREAD,function(msg){modelHandler(msg[0],function(model){return model.toggleLocked(false,msg[1]);});}),_defineProperty(_$extend,common.DELETE_IMAGES,function(msg){modelHandler(msg[0],function(model){return model.removeImage(msg[1]);});}),_defineProperty(_$extend,common.SPOILER_IMAGES,function(msg){modelHandler(msg[0],function(model){return model.setSpoiler(msg[1],msg[2]);});}),_defineProperty(_$extend,common.BAN,function(msg){var _msg3=_slicedToArray(msg,2);var num=_msg3[0];var info=_msg3[1];if(!num){if(!info)return;info=JSON.parse(info);num=info.num;}modelHandler(num,function(model){return model.setBan(num,info);});}),_defineProperty(_$extend,common.BACKLINK,function(msg){modelHandler(msg[0],function(model){return model.addBacklink(msg[1],msg[2]);});}),_defineProperty(_$extend,common.ONLINE_COUNT,function(msg){online.textContent='['+msg[0]+']';}),_defineProperty(_$extend,common.HOT_INJECTION,function(msg){var _msg4=_slicedToArray(msg,3);var force=_msg4[0];var hash=_msg4[1];var hotConfig=_msg4[2];if(!force&&hash!==state.configHash)main.send([common.HOT_INJECTION,true]);else if(force){state.configHash=hash;state.hotConfig.set(hotConfig);}}),_$extend));dispatcher[common.SYNCHRONIZE]=main.connSM.feeder('sync');dispatcher[common.INVALID]=main.connSM.feeder('invalid');util.listener(document,'click','del',function(event){if(event.spoilt)return;event.spoilt=true;event.target.classList.toggle('reveal');});}};});"],"sourceRoot":"/source/"}