{"version":3,"sources":["hover.js"],"names":["System","register","_export","_context","main","Article","$","Backbone","etc","options","state","mousemove","ImageHoverView","PostPreview","HoverPostView","ltarget","postHover","setters","execute","require","posts","Model","View","extend","initialize","_this","this","listenTo","model","check","reply","$el","empty","event","get","$target","target","is","hasClass","children","remove","src","closest","attr","isWebm","test","autoplay","loop","appendTo","args","parentNum","redirect","render","addClass","update","num","getID","el","_this2","m","text","match","post","targetPos","offset","previewView","one","stopListening","find","filter","includes","each","css","position","hide","document","body","append","w","width","h","height","detach","show","$w","window","l","left","scrollLeft","t","top","scrollTop","overflowR","innerWidth","Math","max","undefined","isMobile","defer","$doc","on","e","set","hover","getElementById"],"mappings":"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","file":"hover.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var main,Article,$,Backbone,etc,options,state,mousemove,ImageHoverView,PostPreview,HoverPostView,ltarget,postHover;return {setters:[],execute:function(){main=require('./main');Article=main.posts.Article;$=main.$;Backbone=main.Backbone;etc=main.etc;options=main.options;state=main.state;mousemove=new Backbone.Model();ImageHoverView=Backbone.View.extend({initialize:function initialize(){var _this=this;this.listenTo(this.model,'change:event',this.check);main.reply('imager:clicked',function(){return _this.$el.empty();});},check:function check(model,event){if(!options.get('imageHover'))return;var $target=$(event.target);if(!$target.is('img')||$target.hasClass('expanded'))return this.$el.children().remove(\"img,video\");var src=$target.closest('a').attr('href'),isWebm=/\\.webm$/.test(src);if(/\\.pdf$/.test(src)||/\\.mp3$/.test(src)||isWebm&&!options.get('webmHover'))return this.$el.empty();$(isWebm?'<video/>':'<img/>',{src:src,autoplay:true,loop:true}).appendTo(this.$el.empty());}});PostPreview=Article.extend({initialize:function initialize(args){this.parentNum=args.parentNum;this.listenTo(this.model,'dispatch',this.redirect).render().$el.addClass('preview');this.update();},update:function update(){if(!this.num)this.num=etc.getID(this.el);postHover.render(this.$el,this.parentNum);}});HoverPostView=Backbone.View.extend({initialize:function initialize(){this.listenTo(this.model,'change:event',this.check);},check:function check(model,event){var _this2=this;var $target=$(event.target);if(!$target.is('a.history'))return;var m=$target.text().match(/^>>(\\d+)/);if(!m)return;var post=state.posts.get(m[1]);if(!post)return;this.targetPos=$target.offset();this.previewView=new PostPreview({model:post,parentNum:etc.getID(event.target)});$target.one('mouseleave click',function(){return _this2.remove();});},remove:function remove(){if(!this.previewView)return;this.targetPos=null;this.previewView.remove();this.stopListening(this.previewView);this.$el.children().remove('.preview');this.previewView=null;},render:function render($el,num){$el.find('a.history').filter(function(){return this.text.includes('>>'+num);}).each(function(){$(this).addClass('referenced');});$el.css(this.position($el)).appendTo(this.$el.empty());},position:function position($el){$el.hide();$(document.body).append($el);var w=$el.width();var h=$el.height();$el.detach().show();var $w=$(window);var l=this.targetPos.left-$w.scrollLeft();var t=this.targetPos.top-$w.scrollTop()-h-17;if(t<0)t+=h+34;var overflowR=l+w-$w.innerWidth();if(overflowR>-30)l=Math.max(0,l-overflowR-30);return {left:l,top:t};}});ltarget=undefined;postHover=undefined;if(!main.isMobile){main.defer(function(){main.$doc.on('mousemove',function(e){if(e.target!=ltarget){mousemove.set('event',e);ltarget=e.target;}});var hover=document.getElementById('hover_overlay');new ImageHoverView({model:mousemove,el:hover});postHover=new HoverPostView({model:mousemove,el:hover});});}}};});"],"sourceRoot":"/source/"}