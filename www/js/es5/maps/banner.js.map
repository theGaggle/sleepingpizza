{"version":3,"sources":["banner.js"],"names":["System","register","_export","_context","_taggedTemplateLiteral","strings","raw","Object","freeze","defineProperties","value","_templateObject","_templateObject2","main","Backbone","common","dispatcher","etc","options","modalMap","BannerView","banner","NotificationView","setters","execute","require","banner_identity","banner_FAQ","banner_schedule","View","extend","initialize","this","center","document","getElementById","info","reply","clearRadio","events","click .bfloat","renderInfo","msg","innerHTML","revealBmodal","event","bmodal","target","closest","getAttribute","el","isShown","getComputedStyle","display","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","queryAll","Symbol","iterator","next","done","_el","style","err","top","offsetHeight","renderRadio","data","JSON","parse","attrs","title","lang","googleSong","href","encodeURIComponent","np","parseHTML","listeners","dj","exports","view","notification","render","click","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_el2","remove","class","parseDOM","after","setElement","NOTIFICATION","UPDATE_BANNER","RADIO","get","isMobile"],"mappings":"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","file":"banner.js","sourcesContent":["/*\n * Handles all things banner and notifications\n */\n\nconst main = require('./main'),\n\t{Backbone, common, dispatcher, etc, options} = main;\n\nconst modalMap = {\n\t'options': 'options-panel',\n\t'banner_identity': 'identity',\n\t'banner_FAQ': 'FAQ',\n\t'banner_schedule': 'schedule'\n};\n\nconst BannerView = Backbone.View.extend({\n\tinitialize() {\n\t\tthis.center = document.getElementById('banner_center');\n\t\tthis.info = document.getElementById('banner_info');\n\t\t// Publish a listener to the message bus\n\t\tmain.reply('banner:radio:clear', this.clearRadio, this);\n\t},\n\tevents: {\n\t\t'click .bfloat': 'revealBmodal'\n\t},\n\trenderInfo(msg) {\n\t\tthis.info.innerHTML = msg;\n\t},\n\t// Toggle the display of the modal windows under the banner\n\trevealBmodal(event) {\n\t\tconst bmodal = modalMap[event.target.closest('.bfloat')\n\t\t\t.getAttribute('id')];\n\t\tif (!bmodal)\n\t\t\treturn;\n\t\tconst el = document.getElementById(bmodal),\n\t\t\tisShown = el && getComputedStyle(el).display !== 'none';\n\t\tfor (let el of document.queryAll('.bmodal')) {\n\t\t\tel.style.display = 'none'\n\t\t}\n\n\t\t// We hid the currently displayed window. All is well\n\t\tif (isShown)\n\t\t\treturn;\n\n\t\t// Place 5 pixels bellow banner\n\t\tel.style.top = document.getElementById('banner').offsetHeight + 5\n\t\t\t+ 'px';\n\t\tel.style.display = 'block';\n\t},\n\t// r/a/dio stream info rendering\n\trenderRadio(data) {\n\t\tdata = JSON.parse(data);\n\t\tconst attrs = {\n\t\t\ttitle: main.lang.googleSong,\n\t\t\thref: `https://google.com/search?q=${encodeURIComponent(data.np)}`,\n\t\t\ttarget: '_blank'\n\t\t};\n\t\tthis.center.innerHTML = common.parseHTML\n\t\t\t`<a href=\"http://r-a-d.io/\" target=\"_blank\">\n\t\t\t\t[${data.listeners}] ${data.dj}\n\t\t\t</a>\n\t\t\t&nbsp;&nbsp;\n\t\t\t<a ${attrs}>\n\t\t\t\t<b>${data.np}</b>\n\t\t\t</a>`;\n\t},\n\tclearRadio() {\n\t\tthis.center.innerHTML = '';\n\t}\n});\n\nconst banner = exports.view = new BannerView({\n\tel: document.getElementById('banner')\n});\n\n// Notification messages bellow the banner\nconst NotificationView = exports.notification = Backbone.View.extend({\n\tinitialize(msg) {\n\t\tthis.render(msg);\n\t},\n\tevents: {\n\t\t'click': 'remove'\n\t},\n\trender(msg) {\n\t\tfor (let el of document.queryAll('.notification')) {\n\t\t\tel.remove();\n\t\t}\n\t\tconst attrs = {\n\t\t\tclass: 'notification modal',\n\t\t\tstyle: `top: ${banner.el.offsetHeight + 5}px;`\n\t\t};\n\t\tconst el = etc.parseDOM(common.parseHTML\n\t\t\t`<span ${attrs}>\n\t\t\t\t<b class=\"admin\">\n\t\t\t\t\t${msg}\n\t\t\t\t</b>\n\t\t\t</span>`);\n\t\tbanner.el.after(el);\n\t\tthis.setElement(el);\n\t\treturn this;\n\t}\n});\nmain.reply('notification', msg => new NotificationView(msg));\n\ndispatcher[common.NOTIFICATION] = msg => new NotificationView(msg[0]);\ndispatcher[common.UPDATE_BANNER] = msg => banner.renderInfo(msg[0]);\n// R/a/dio banner is disabled on mobile\ndispatcher[common.RADIO] = msg =>\n\toptions.get('nowPlaying') && !main.isMobile && banner.renderRadio(msg[0]);\n"],"sourceRoot":"/source/"}