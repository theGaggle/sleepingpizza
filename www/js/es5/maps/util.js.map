{"version":3,"sources":["util.js"],"names":["System","register","_export","_context","config","escape","thumbStyles","setters","_main","_underscore","execute","touchable_spoiler_tag","del","innerHTML","getNum","el","parseInt","getAttribute","slice","getID","closest","parseEls","string","document","createElement","children","childNodes","Array","from","parseEl","firstChild","listener","type","selector","handler","addEventListener","event","target","matches","once","removeEventListener","outerWidth","style","getComputedStyle","props","width","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","prop","value","err","isSage","email","trim","pick_spoiler","metaIndex","imgs","SPOILER_IMAGES","n","length","i","Math","floor","random","index","pad","resonableLastN","Number","isInteger","randomID","len","id","char","toString","toUpperCase","parseHTML","callSite","output","arguments","replace","parseAttributes","attrs","html","key","val","commaList","items","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","item","checkAuth","action","cls","staff","classes","main","ident","auth","rights"],"mappings":"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","file":"util.js","sourcesContent":["/*\n Client-side helper functions\n */\n\nimport {config} from './main'\nimport {escape} from 'underscore'\n\n// Make spoiler tags toggleable on mobile\nexport function touchable_spoiler_tag(del) {\n\tdel.innerHTML = '<del onclick=\"void(0)\">'\n}\n\n// Retrieve post number of post element\nexport function getNum(el) {\n\tif (!el) {\n\t\treturn 0\n\t}\n\treturn parseInt(el.getAttribute('id').slice(1), 10)\n}\n\n// Retrieve post number of closest parent post\nexport function getID(el) {\n\tif (!el) {\n\t\treturn 0\n\t}\n\treturn getNum(el.closest('article, section'))\n}\n\n\n// Parse HTML string to node array\nexport function parseEls(string) {\n\tconst el = document.createElement('div')\n\tel.innerHTML = string\n\tconst children = el.childNodes\n\treturn Array.from(children)\n}\n\n// Parse HTML string to single Element\nexport function parseEl(string) {\n\tconst el = document.createElement('div')\n\tel.innerHTML = string\n\treturn el.firstChild\n}\n\n// Add an event listener that filters targets according to a CSS selector\nexport function listener(el, type, selector, handler) {\n\tel.addEventListener(type, event => {\n\t\tif (event.target.matches(selector)) {\n\t\t\thandler(event)\n\t\t}\n\t})\n}\n\n// Add event listener to element, that will only be executed once\nexport function once(el, type, handler) {\n\tel.addEventListener(type, event => {\n\t\thandler(event)\n\t\tel.removeEventListener(type, handler)\n\t})\n}\n\n// Return width of element with padding and margin\nexport function outerWidth(el) {\n\tconst style =  getComputedStyle(el),\n\t\tprops = ['marginLeft', 'marginRight', 'paddingLeft','paddingRight']\n\tlet width = 0\n\tfor (let prop of props) {\n\t\twidth += parseInt(style[prop]);\n\t}\n\treturn width\n}\n\n\n// Confirms email is saging\nexport function isSage(email) {\n\tif (email) {\n\t\treturn email.trim() === 'sage'\n\t}\n\treturn false\n}\n\n// TODO: Refactor server time syncronisation\n// let cachedOffset;\n// export function serverTime() :number {\n// \tconst d = Date.now();\n// \tif (imports.isNode)\n// \t\treturn d;\n//\n// \t// The offset is intialised as 0, so there is something to return, until\n// \t// we get a propper number from the server.\n// \tif (!cachedOffset)\n// \t\tcachedOffset = imports.main.request('time:offset');\n// \treturn d + cachedOffset;\n// }\n\n// Pick the next spoiler from one of the available spoilers\nexport function pick_spoiler(metaIndex) {\n\tconst imgs = config.SPOILER_IMAGES,\n\t\tn = imgs.length\n\tlet i\n\tif (metaIndex < 0) {\n\t\ti = Math.floor(Math.random() * n)\n\t} else {\n\t\ti = metaIndex % n\n\t}\n\treturn {\n\t\tindex: imgs[i],\n\t\tnext: (i + 1) % n\n\t}\n}\n\nexport const thumbStyles = ['small', 'sharp', 'hide']\n\n// Pad an integer with a leading zero, if below 10\nexport function pad(n) {\n\treturn (n < 10 ? '0' : '') + n\n}\n\n// Various UI-related links wrapped in []\n// export function action_link_html(href , name, id, cls) {\n// \treturn parseHTML\n// \t\t`<span class=\"act\">\n// \t\t\t<a href=\"${href}\"\n// \t\t\t\t${id && ` id=\"${id}\"`}\n// \t\t\t\t${cls && ` class=\"${cls}\"`}\n// \t\t\t>\n// \t\t\t\t${name}\n// \t\t\t</a>\n// \t\t</span>`;\n// }\n\n// Confirm last N posts to view setting matches bounds\nexport function resonableLastN(n) {\n\treturn Number.isInteger(n) && n <= 500\n}\n\n// export function parse_name(name) {\n// \tvar tripcode = '', secure = '';\n// \tvar hash = name.indexOf('#');\n// \tif (hash >= 0) {\n// \t\ttripcode = name.substr(hash + 1);\n// \t\tname = name.substr(0, hash);\n// \t\thash = tripcode.indexOf('#');\n// \t\tif (hash >= 0) {\n// \t\t\tsecure = escape(tripcode.substr(hash + 1));\n// \t\t\ttripcode = tripcode.substr(0, hash);\n// \t\t}\n// \t\ttripcode = escape(tripcode);\n// \t}\n// \tname = name.trim().replace(imports.hotConfig.EXCLUDE_REGEXP, '');\n// \treturn [\n// \t\tname.substr(0, 100), tripcode.substr(0, 128),\n// \t\tsecure.substr(0, 128)\n// \t];\n// }\n\n// Generate a random alphannumeric string of lower and upper case hexadecimal\n// characters\nexport function randomID(len) {\n\tlet id = ''\n\tfor (let i = 0; i < len; i++) {\n\t\tlet char = (Math.random() * 36).toString(36)[0]\n\t\tif (Math.random() < 0.5) {\n\t\t\tchar = char.toUpperCase()\n\t\t}\n\t\tid += char\n\t}\n\treturn id\n}\n\n// Template string tag function for HTML. Strips indentation and trailing\n// newlines. Based on https://gist.github.com/zenparsing/5dffde82d9acef19e43c\nexport function parseHTML(callSite, ...args) {\n\tlet output = callSite[0]\n\tfor (let i = 1; i <= args.length; i++) {\n\t\toutput += args[i - 1] + callSite[i]\n\t}\n\n\t// Strip indentation and remove empty lines from HTML string\n\treturn output.replace(/\\s*\\n\\s*/g, '')\n}\n\n\n// Generate an HTML element attribute list\nexport function parseAttributes(attrs) {\n\tlet html = ''\n\tfor (let key in attrs) {\n\t\thtml += ' '\n\t\tconst val = attrs[key]\n\t\tif (val === true) {\n\t\t\thtml += key\n\t\t} else if (val || val === 0) {\n\t\t\thtml += `${key}=\"${val}\"`\n\t\t}\n\t}\n\treturn html\n}\n\n// Makes a ', ' seperated list out of on array of strings\nexport function commaList(items) {\n\tlet html = ''\n\tfor (let item of items) {\n\t\tif (html) {\n\t\t\thtml += ', '\n\t\t}\n\t\thtml += item\n\t}\n\treturn html\n}\n\n// Acertains client has the proper authorisation to perfrom task. This is only\n// for rendering. The same validation is performed server-side.\nexport function checkAuth(action) {\n\tconst cls = config.staff.classes[main.ident && main.ident.auth]\n\treturn cls && !!cls.rights[action]\n}\n"],"sourceRoot":"/source/"}