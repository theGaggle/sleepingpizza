{"version":3,"sources":["posts/menu.js"],"names":["System","register","_export","_context","main","$","_","Backbone","common","util","lang","state","MenuView","setters","execute","require","module","exports","View","extend","className","tagName","actions","events","click","initialize","_ref","parent","_popup_menu","this","render","html","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","action","value","err","el","innerHTML","append","style","left","getBoundingClientRect","outerWidth","offsetWidth","handleClick","e","stopPropagation","request","target","getAttribute","model","remove","stopListening","reply","prototype","$threads","on","event","getModel"],"mappings":"AAAA,YAAaA,QAAOC,YAAY,SAASC,EAAQC,GAAU,GAAIC,GAAKC,EAAEC,EAAEC,EAASC,EAAOC,EAAKC,EAAKC,EAAMC,CAAS,QAAQC,WAAWC,QAAQ,WAAWV,EAAKW,QAAQ,WAAWV,EAAED,EAAKC,EAAEC,EAAEF,EAAKE,EAAEC,EAASH,EAAKG,SAASC,EAAOJ,EAAKI,OAAOC,EAAKL,EAAKK,KAAKC,EAAKN,EAAKM,KAAKC,EAAMP,EAAKO,MAAMC,EAASI,OAAOC,QAAQV,EAASW,KAAKC,QAAQC,UAAU,mBAAmBC,QAAQ,KAAKC,SAAS,SAAS,QAAQC,QAAQC,MAAM,eAAeC,WAAW,SAAoBC,GAAM,GAAIC,GAAOD,EAAKC,MAAOA,GAAOC,YAAYC,KAAKA,KAAKF,OAAOA,EAAOE,KAAKC,UAAWA,OAAO,WAAkB,GAAIC,GAAK,GAAOC,GAA0B,EAASC,GAAkB,EAAUC,EAAeC,MAAU,KAAI,IAAI,GAsBppBC,GAtBwpBC,EAsBxpBR,KAAKP,QAALgB,OAAAC,cAAAP,GAAAI,EAAAC,EAAAG,QAAAC,MAAAT,GAAA,EAAA,CAAA,GAAAU,GAAAN,EAAAO,KAAAZ,IAAA,kBAAAW,EAAA,KAAAhC,EAAAgC,GAAA,SAAA,MAAAE,GAAAX,GAAA,EAAAC,EAAAU,EAAA,QAAA,KAAAZ,GAAAK,EAAAA,WAAAA,EAAAA,YAAA,QAAA,GAAAJ,EAAA,KAAAC,IAAA,GAAAW,GAAAhB,KAAAgB,GAAAlB,EAAAE,KAAAF,MAAAkB,GAAAC,UAAAf,EAAAJ,EAAAoB,OAAAF,GAAAA,EAAAG,MAAAC,KAAAJ,EAAAK,wBAAAD,KAAA,IAAAxC,EAAA0C,WAAAN,GAAAA,EAAAO,aAAA,MAAAC,YAAA,SAAAC,GAAAA,EAAAC,kBAAAnD,EAAAoD,QAAAF,EAAAG,OAAAC,aAAA,aAAA7B,KAAA8B,OAAA9B,KAAA+B,UAAAA,OAAA,WAAA/B,KAAAF,OAAAC,YAAA,KAAAC,KAAAgB,GAAAe,SAAA/B,KAAAgC,mBAAAzD,EAAA0D,MAAA,cAAA,SAAApB,GAAA,MAAApC,GAAAa,OAAAP,EAAAmD,UAAAzC,QAAAoB,KAAAtC,EAAA4D,SAAAC,GAAA,QAAA,WAAA,SAAAC,GAAA,GAAAT,GAAAS,EAAAT,MAAA,IAAAA,EAAA7B,YAAA,MAAA6B,GAAA7B,YAAAgC,QAAA,IAAAD,GAAAlD,EAAA0D,SAAAV,EAAAE,IAAA,GAAA/C,IAAAe,OAAA8B,EAAAE,MAAAA","file":"posts/menu.js","sourcesContent":["/*\n Post action header dropdown menu\n */\n\nconst main = require('../main'),\n\t{$, _, Backbone, common, util, lang, state} = main;\n\nconst MenuView = module.exports = Backbone.View.extend({\n\tclassName: 'popup-menu glass',\n\ttagName: 'ul',\n\t// Post menu items\n\tactions: ['report', 'hide'],\n\tevents: {\n\t\tclick: 'handleClick'\n\t},\n\tinitialize({parent}) {\n\t\tparent._popup_menu = this;\n\t\tthis.parent = parent;\n\t\tthis.render();\n\t},\n\trender() {\n\t\tlet html = '';\n\t\tfor (let action of this.actions) {\n\t\t\thtml += `<li data-type=\"${action}\">${lang[action]}</li>`\n\t\t}\n\t\tconst {el, parent} = this;\n\t\tel.innerHTML = html;\n\t\tparent.append(el);\n\n\t\t// Calculate position. Can't use CSS translate, because it shifts\n\t\t// the background.\n\t\tel.style.left = el.getBoundingClientRect().left\n\t\t\t- (util.outerWidth(el) + el.offsetWidth) * 0.6\n\t\t\t+ 'px';\n\t},\n\t// Forward post model to appropriate handler\n\thandleClick(e) {\n\t\te.stopPropagation();\n\t\tmain.request(e.target.getAttribute('data-type'), this.model);\n\t\tthis.remove();\n\t},\n\tremove() {\n\t\tthis.parent._popup_menu = null;\n\t\tthis.el.remove();\n\t\tthis.stopListening();\n\t}\n});\n\nmain.reply('menu:extend', action =>\n\t_.extend(MenuView.prototype.actions, action));\n\nmain.$threads.on('click', '.control', event => {\n\tconst {target} = event;\n\n\t// Menu already exists on the element. Remove it instead.\n\tif (target._popup_menu)\n\t\treturn target._popup_menu.remove();\n\n\tconst model = util.getModel(target);\n\tif (model)\n\t\tnew MenuView({parent: target, model});\n});\n"],"sourceRoot":"/source/"}