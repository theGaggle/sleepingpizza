{"version":3,"sources":["posts/embed.js"],"names":["System","register","_export","_context","make_video","id","params","start","allowFullScreen","allowScriptAccess","query","autohide","fs","modestbranding","origin","document","location","rel","showinfo","autoplay","loop","playlist","$","type","src","encodeURI","param","frameborder","attr","video_dims","class","window","screen","width","height","fetchSoundcloud","target","cb","url","encodeURIComponent","getAttribute","xhr","XMLHttpRequest","open","responseType","onload","this","status","response","send","main","util","youtube_url_re","youtube_short_re","youtube_time_re","youtube_short_time_re","soundcloud_url_re","pastebin_re","setters","execute","require","exports","$threads","on","e","timeCall","time","timeRex","t","match","parseInt","$target","css","append","which","metaKey","ctrlKey","altKey","shiftKey","is","$video","find","length","siblings","andSelf","remove","data","m","event","gotInfo","title","node","textContent","orig","color","accessControl","embed","contents","filter","nodeType","ajax","v","alt","dataType","success","error","iframe","preventDefault","previousElementSibling","Math","round","innerWidth","err","json","alert","createElement","parseDOM","html","style","firstChild","text","classList","add","$obj","$window","innerHeight"],"mappings":"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","file":"posts/embed.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var main,$,util,youtube_url_re,youtube_short_re,youtube_time_re,youtube_short_time_re,soundcloud_url_re,pastebin_re;function make_video(id,params,start){if(!params)params={allowFullScreen:'true'};params.allowScriptAccess='always';var query={autohide:1,fs:1,modestbranding:1,origin:document.location.origin,rel:0,showinfo:0};if(start)query.start=start;if(params.autoplay)query.autoplay=params.autoplay;if(params.loop){query.loop='1';query.playlist=id;}return $('<iframe></iframe>',{type:'text/html',src:encodeURI('https://www.youtube.com/embed/'+id)+'?'+$.param(query),frameborder:'0',attr:video_dims(),class:'youtube-player'});}function video_dims(){if(window.screen&&screen.width<=320)return {width:250,height:150};else return {width:560,height:340};}function make_embed(uri,params,dims){var $obj=$('<object/>',{attr:dims});for(var name in params){$('<param/>',{attr:{name:name,value:params[name]}}).appendTo($obj);}$('<embed/>',{src:uri,type:'application/x-shockwave-flash'}).attr(dims).attr(params).appendTo($obj);return $obj;}function fetchSoundcloud(target,width,cb){var url='https://soundcloud.com/oembed?url='+encodeURIComponent(target.getAttribute('href'))+('&maxwidth='+width+'&maxheight=166&auto_play=true&format=json')+'&show_comments=false';var xhr=new XMLHttpRequest();xhr.open('GET',url);xhr.responseType='json';xhr.onload=function(){if(this.status!==200)return cb(this.status);cb(null,this.response);};xhr.send();}return {setters:[],execute:function(){main=require('../main');$=main.$;util=main.util;youtube_url_re=exports.youtube_url_re=/(?:>>>*?)?(?:https?:\\/\\/)?(?:www\\.|m.)?youtube\\.com\\/watch\\/?\\?((?:[^\\s#&=]+=[^\\s#&]*&)*)?v=([\\w-]{11})((?:&[^\\s#&=]+=[^\\s#&]*)*)&?(#t=[\\dhms]{1,9})?/;youtube_short_re=exports.youtube_short_re=/(?:>>>*?)?(?:https?:\\/\\/)?(?:www\\.|m.)?youtu.be\\/([\\w-]{11})\\??(t=[\\dhms]{1,9})?/;youtube_time_re=exports.youtube_time_re=/^#t=(?:(\\d\\d?)h)?(?:(\\d{1,3})m)?(?:(\\d{1,3})s)?$/;youtube_short_time_re=exports.youtube_short_time_re=/^t=(?:(\\d\\d?)h)?(?:(\\d{1,3})m)?(?:(\\d{1,3})s)?$/;main.$threads.on('click','.watch',function(e){if(e.which>1||e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;var $target=$(e.target);if(!$target.is('a'))return;var $video=$target.find('iframe');if($video.length){$video.siblings('br').andSelf().remove();$target.css('width','auto');return false;}if($target.data('noembed'))return;var m=$target.attr('href').match(youtube_url_re);if(!m){m=$target.attr('href').match(youtube_short_re);if(!m)return;timeCall(m[1],m[2],youtube_short_time_re);}timeCall(m[2],m[4],youtube_time_re);function timeCall(url,time,timeRex){var start=0;if(time){var t=time.match(timeRex);if(t){if(t[1])start+=parseInt(t[1],10)*3600;if(t[2])start+=parseInt(t[2],10)*60;if(t[3])start+=parseInt(t[3],10);}}$target.css('width',video_dims().width).append('<br>',make_video(url,null,start));}return false;});main.$threads.on('mouseenter','.watch',function(event){var $target=$(event.target);if($target.data('requestedTitle'))return;$target.data('requestedTitle',true);var node=$target.contents().filter(function(){return this.nodeType===3;})[0];if(!node)return;var orig=node.textContent;node.textContent=orig+'...';var m=$target.attr('href').match(youtube_url_re);if(!m){m=$target.attr('href').match(youtube_short_re);if(!m)return;$.ajax({url:'//gdata.youtube.com/feeds/api/videos/'+m[1],data:{v:'2',alt:'jsonc'},dataType:'json',success:gotInfo,error:function error(){node.textContent=orig+'???';}});}$.ajax({url:'//gdata.youtube.com/feeds/api/videos/'+m[2],data:{v:'2',alt:'jsonc'},dataType:'json',success:gotInfo,error:function error(){node.textContent=orig+'???';}});function gotInfo(data){var title=data&&data.data&&data.data.title;if(title){node.textContent=orig+': '+title;$target.css({color:'black'});}else node.textContent=orig+' (gone?)';if(data&&data.data&&data.data.accessControl&&data.data.accessControl.embed==='denied'){node.textContent+=' (EMBEDDING DISABLED)';$target.data('noembed',true);}}});soundcloud_url_re=exports.soundcloud_url_re=/(?:>>>*?)?(?:https?:\\/\\/)?(?:www\\.)?soundcloud\\.com\\/([\\w-]{1,40}\\/[\\w-]{1,80})\\/?/;main.$threads.on('click','.soundcloud',function(e){if(e.which>1||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;var target=e.target;var iframe=target.query('iframe');e.preventDefault();if(iframe){iframe.previousElementSibling.remove();iframe.remove();return;}var width=Math.round(window.innerWidth*0.75);fetchSoundcloud(target,width,function(err,json){if(err)return alert(err);target.append(document.createElement('br'));target.append(util.parseDOM(json.html));target.style.width=width+'px';});});main.$threads.on('mouseenter','.soundcloud:not(.fetched)',function(event){var target=event.target;var node=target.firstChild;var text=node.textContent;node.textContent=text+' ...';fetchSoundcloud(target,1000,function(err,json){if(err)return node.textContent=text+': Error: '+err;node.textContent=text+': '+json.title;target.style.color='black';target.classList.add('fetched');});});pastebin_re=exports.pastebin_re=/(?:>>>*?)?(?:https?:\\/\\/)?(?:www\\.|m.)?pastebin\\.com\\/(.*)/;$(document).on('click','.pastebin',function(event){if(event.which>1||event.ctrlKey||event.altKey||event.shiftKey||event.metaKey)return;var $target=$(event.target);var $obj=$target.find('iframe');if($obj.length){$obj.siblings('br').andSelf().remove();$target.css({width:'auto',height:'auto'});return false;}var m=$target.attr('href').match(pastebin_re);if(!m)return;var $window=$(window),width=Math.round($window.innerWidth()*0.65),height=Math.round($window.innerHeight()*0.65);$target.css({width:width,height:height}).append('<br>',$('<iframe></iframe>',{type:'text/html',src:'https://pastebin.com/embed_iframe.php?i='+m[1],frameborder:'0',width:width,height:height}));return false;});}};});"],"sourceRoot":"/source/"}