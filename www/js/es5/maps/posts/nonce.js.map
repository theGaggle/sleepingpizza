{"version":3,"sources":["posts/nonce.js"],"names":["System","register","_export","_context","get","nonces","window","localStorage","JSON","parse","postNonces","e","nonceCache","save_nonces","stringify","today_id","Math","floor","Date","now","create","nonce","common","randomID","tab","state","page","day","destroy","setTimeout","main","setters","execute","require","reply","changed","undefined","yesterday","random"],"mappings":"AAAA,YAAaA,QAAOC,YAAY,SAASC,EAAQC,GAA2C,QAASC,KAAM,GAAIC,EAAO,IAAGC,OAAOC,aAAc,IAAIF,EAAOG,KAAKC,MAAMF,aAAaG,YAAa,MAAMC,QAAUN,GAAOO,CAAW,OAAOP,OAAY,QAASQ,GAAYR,GAAWC,OAAOC,aAAaA,aAAaG,WAAWF,KAAKM,UAAUT,GAAaO,EAAWP,EAAQ,QAASU,KAAW,MAAOC,MAAKC,MAAMC,KAAKC,MAAM,OAAkB,QAASC,KAAS,GAAIf,GAAOD,IAAMiB,EAAMC,EAAOC,SAAS,GAAmF,OAA/ElB,GAAOgB,IAAQG,IAAIC,EAAMC,KAAKtB,IAAI,SAASuB,IAAIZ,KAAYF,EAAYR,GAAegB,EAAO,QAASO,GAAQP,GAAOQ,WAAW,WAAW,GAAIxB,GAAOD,GAAUC,GAAOgB,WAAqBhB,GAAOgB,GAAOR,EAAYR,KAAU,KAAnpB,GAAIyB,GAAKR,EAAOG,EAAMb,CAAqoB,QAAQmB,WAAWC,QAAQ,WAAWF,EAAKG,QAAQ,WAAWX,EAAOQ,EAAKR,OAAOG,EAAMK,EAAKL,MAAMb,KAAckB,EAAKI,MAAM,YAAY9B,GAAK0B,EAAKI,MAAM,eAAed,GAAQS,WAAW,WAAW,GAAIvB,OAAOC,aAAX,CAA+B,GAAIF,GAAOD,IAAU+B,EAAQC,OAAcC,EAAUtB,IAAW,CAAE,KAAI,GAAIM,KAAShB,GAAWA,EAAOgB,GAAOM,KAAKU,UAA0BhC,GAAOgB,GAAOc,GAAQ,EAASA,IAAQtB,EAAYR,KAAUW,KAAKC,MAAoB,IAAdD,KAAKsB,WAAgBR,EAAKI,MAAM,gBAAgBN","file":"posts/nonce.js","sourcesContent":["'use strict';System.register([],function(_export,_context){var main,common,state,nonceCache;function get(){var nonces;if(window.localStorage){try{nonces=JSON.parse(localStorage.postNonces);}catch(e){}}else nonces=nonceCache;return nonces||{};}function save_nonces(nonces){if(window.localStorage)localStorage.postNonces=JSON.stringify(nonces);else nonceCache=nonces;}function today_id(){return Math.floor(Date.now()/(1000*60*60*24));}function create(){var nonces=get(),nonce=common.randomID(32);nonces[nonce]={tab:state.page.get('tabID'),day:today_id()};save_nonces(nonces);return nonce;}function destroy(nonce){setTimeout(function(){var nonces=get();if(!nonces[nonce])return;delete nonces[nonce];save_nonces(nonces);},10000);}return {setters:[],execute:function(){main=require('../main');common=main.common;state=main.state;nonceCache={};main.reply('nonce:get',get);main.reply('nonce:create',create);setTimeout(function(){if(!window.localStorage)return;var nonces=get();var changed=undefined;var yesterday=today_id()-1;for(var nonce in nonces){if(nonces[nonce].day>=yesterday)continue;delete nonces[nonce];changed=true;}if(changed)save_nonces(nonces);},Math.floor(Math.random()*5000));main.reply('nonce:destroy',destroy);}};});"],"sourceRoot":"/source/"}